

@뉴탄막전투(ARG,ARG:1)
;ARG - 내 번호
;ARG:1 - 상대방 번호
CALL 뉴탄막전투초기화(ARG,ARG:1)
CALL 뉴탄막루틴

@뉴탄막전투초기화(ARG,ARG:1)
T_나 = ARG
T_적 = ARG:1


T_내체력 = BASE:ARG:체력+MIN((10*CFLAG:ARG:인내),1000)
T_내최대체력 = T_내체력
T_내힘 = CFLAG:T_나:힘
T_내지성= CFLAG:T_나:지성
T_내인내= CFLAG:T_나:인내
T_내속도= CFLAG:T_나:속도
T_내운= CFLAG:T_나:운
T_내물리내성= CFLAG:T_나:물리내성
T_내화염내성= CFLAG:T_나:화염내성
T_내빙결내성= CFLAG:T_나:빙결내성
T_내전격내성= CFLAG:T_나:전격내성
T_내질풍내성= CFLAG:T_나:질풍내성
T_내마력내성= CFLAG:T_나:마력내성
T_내수격내성= CFLAG:T_나:수격내성
T_내정신내성= CFLAG:T_나:정신내성
;---
T_적체력 = BASE:T_적:체력+MIN(10*(CFLAG:(ARG:1):인내),1000)
T_적최대체력 = T_적체력
T_적힘 = CFLAG:T_적:힘
T_적지성= CFLAG:T_적:지성
T_적인내= CFLAG:T_적:인내
T_적속도= CFLAG:T_적:속도
T_적운= CFLAG:T_적:운
T_적물리내성= CFLAG:T_적:물리내성
T_적화염내성= CFLAG:T_적:화염내성
T_적빙결내성= CFLAG:T_적:빙결내성
T_적전격내성= CFLAG:T_적:전격내성
T_적질풍내성= CFLAG:T_적:질풍내성
T_적마력내성= CFLAG:T_적:마력내성
T_적수격내성= CFLAG:T_적:수격내성
T_적정신내성= CFLAG:T_적:정신내성
CALL 공방세팅

;----
;기타변수 초기화 
;----

;----

@공방세팅
T_내공격력= (T_내힘*20)+ (T_내속도*5)+(T_내공격력보정)
T_내방어력= (T_내속도*5)+ (T_내인내*15)+(T_내운)+(T_내방어력보정)
SELECTCASE ABL:T_나:전투능력
    CASE 0
        TIMES T_내공격력, 1.0
        TIMES T_내방어력, 1.0
    CASE 1
        TIMES T_내공격력, 1.3
        TIMES T_내방어력, 1.3
    CASE 2
        TIMES T_내공격력, 1.6
        TIMES T_내방어력, 1.6
    CASE 3
        TIMES T_내공격력, 1.9
        TIMES T_내방어력, 1.9
    CASE 4
        TIMES T_내공격력, 2.2
        TIMES T_내방어력, 2.2
    CASE 5
        TIMES T_내공격력, 2.5
        TIMES T_내방어력, 2.5
    CASE 6
        TIMES T_내공격력, 2.7
        TIMES T_내방어력, 2.7
    CASE 7
        TIMES T_내공격력, 2.9
        TIMES T_내방어력, 2.9
    CASEELSE
        TIMES T_내공격력, 3.0
        TIMES T_내방어력, 3.0
ENDSELECT
T_적공격력= (T_적힘*20) + (T_적속도*5)+(T_적공격력보정)
T_적방어력= (T_적속도*5)+ (T_적인내*15)+(T_적운*5)+(T_적방어력보정)
IF 고로시 == 1
    TIMES 적공격력, 2.0
    TIMES 적방어력, 2.0
ENDIF
SELECTCASE ABL:T_적:전투능력
    CASE 0
        TIMES T_적공격력, 1.0
        TIMES T_적방어력, 1.0
    CASE 1
        TIMES T_적공격력, 1.3
        TIMES T_적방어력, 1.3
    CASE 2
        TIMES T_적공격력, 1.6
        TIMES T_적방어력, 1.6
    CASE 3
        TIMES T_적공격력, 1.9
        TIMES T_적방어력, 1.9
    CASE 4
        TIMES T_적공격력, 2.2
        TIMES T_적방어력, 2.2
    CASE 5
        TIMES T_적공격력, 2.5
        TIMES T_적방어력, 2.5
    CASE 6
        TIMES T_적공격력, 2.7
        TIMES T_적방어력, 2.7
    CASE 7
        TIMES T_적공격력, 2.9
        TIMES T_적방어력, 2.9
    CASEELSE
        TIMES T_적공격력, 3.0
        TIMES T_적방어력, 3.0
ENDSELECT


@뉴탄막루틴
$내턴루틴
CALL 공방세팅
CALL 뉴탄막상태창
CALL 뉴탄막커맨드창
T_턴주인 = T_나
T_턴반대 = T_적
$내턴입력
INPUT
IF RESULT == 100
    ;공격
    CALL T_COM공격한다
    GOTO 내턴루틴
ELSEIF RESULT == 101
    ;스킬사용
    CALL T_COM스킬사용
    GOTO 내턴루틴
ELSEIF RESULT == 102
    ;아이템사용
    GOTO 내턴루틴
ELSEIF RESULT == 200
    ;회피
    GOTO 내턴루틴
ELSEIF RESULT == 201
    ;휴식
    ;일단은 아무처리 안함
ELSEIF RESULT == 999
    ;항복
    RETURN 1
ELSE
    GOTO 내턴입력
ENDIF
;--------
;적턴
;--------
T_턴주인 = T_적
T_턴반대 = T_나
;-------
CALL T_턴엔드
PRINTW
RESTART

@T_턴엔드
FOR LOCAL,1,1000
    TRYCALLFORM T_SKILL{LOCAL}(T_턴주인,"턴엔드")
NEXT


@뉴탄막커맨드창
ALIGNMENT CENTER
PRINTFORM [100] 공격 한다
PRINT    
PRINTFORM [101] 스킬 사용
PRINT    
PRINTFORM [102] 아이템 사용
PRINTL
PRINTFORM [200] 회피에 집중
PRINT    
PRINTFORM [201] 휴식
PRINTL
PRINTFORM [999] 항복
PRINTL
DRAWLINE
ALIGNMENT LEFT


@T_데미지(대상,데미지,속성)
#DIM 대상
#DIM 데미지
#DIMS 속성
IF 대상 == T_나
    IF 고로시 == 1
        TIMES 데미지 , 1.5
    ENDIF
    IF 속성 == "물리"
        IF T_내물리내성 > 0
            IF 데미지 >= T_내물리내성
                데미지 -= T_내물리내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_내물리내성
        ENDIF
    ELSEIF 속성 == "화염"
        IF T_내화염내성 > 0
            IF 데미지 >= T_내화염내성
                데미지 -= T_내화염내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_내화염내성
        ENDIF
    ELSEIF 속성 == "빙결"
        IF T_내빙결내성 > 0
            IF 데미지 >= T_내빙결내성
                데미지 -= T_내빙결내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_내빙결내성
        ENDIF
    ELSEIF 속성 == "전격"
        IF T_내전격내성 > 0
            IF 데미지 >= T_내전격내성
                데미지 -= T_내전격내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_내전격내성
        ENDIF
    ELSEIF 속성 == "질풍"
        IF T_내질풍내성 > 0
            IF 데미지 >= T_내질풍내성
                데미지 -= T_내질풍내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_내질풍내성
        ENDIF
    ELSEIF 속성 == "수격"
        IF T_내수격내성 > 0
            IF 데미지 >= T_내수격내성
                데미지 -= T_내수격내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_내수격내성
        ENDIF
    ELSEIF 속성 == "마력"
        IF T_내마력내성 > 0
            IF 데미지 >= T_내마력내성
                데미지 -= T_내마력내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_내마력내성
        ENDIF
    ELSEIF 속성 == "정신"
        IF T_내정신내성 > 0
            IF 데미지 >= T_내정신내성
                데미지 -= T_내정신내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_내정신내성
        ENDIF
    ELSEIF 속성 == "고정"
        ;처리없음
    ENDIF
    IF T_내방어력 >= 0
        데미지 -= T_내방어력
    ELSE
        데미지 += T_내방어력
    ENDIF
    CALL 크리티컬판정(T_적운)
    IF RESULT == 1
        PRINTFORML 급소에 맞혔다!
        데미지 += T_내운
        TIMES 데미지 , 1.5
    ENDIF
    IF 데미지 > 0
        T_내체력 -= 데미지
        PRINTFORMW {데미지}만큼의 피해를 받았다!
    ELSEIF 데미지 <= -100
        PRINTFORMW 가볍게 피했다
    ELSE
        PRINTFORMW 피했다!
    ENDIF
ELSEIF 대상 == T_적
    IF 속성 == "물리"
        IF T_적물리내성 > 0
            IF 데미지 >= T_적물리내성
                데미지 -= T_적물리내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_적물리내성
        ENDIF
    ELSEIF 속성 == "화염"
        IF T_적화염내성 > 0
            IF 데미지 >= T_적화염내성
                데미지 -= T_적화염내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_적화염내성
        ENDIF
    ELSEIF 속성 == "빙결"
        IF T_적빙결내성 > 0
            IF 데미지 >= T_적빙결내성
                데미지 -= T_적빙결내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_적빙결내성
        ENDIF
    ELSEIF 속성 == "전격"
        IF T_적전격내성 > 0
            IF 데미지 >= T_적전격내성
                데미지 -= T_적전격내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_적전격내성
        ENDIF
    ELSEIF 속성 == "질풍"
        IF T_적질풍내성 > 0
            IF 데미지 >= T_적질풍내성
                데미지 -= T_적질풍내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_적질풍내성
        ENDIF
    ELSEIF 속성 == "수격"
        IF T_적수격내성 > 0
            IF 데미지 >= T_적수격내성
                데미지 -= T_적수격내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_적수격내성
        ENDIF
    ELSEIF 속성 == "마력"
        IF T_적마력내성 > 0
            IF 데미지 >= T_적마력내성
                데미지 -= T_적마력내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_적마력내성
        ENDIF
    ELSEIF 속성 == "정신"
        IF T_적정신내성 > 0
            IF 데미지 >= T_적정신내성
                데미지 -= T_적정신내성
            ELSE
                데미지 = 0
            ENDIF
        ELSE
            데미지 += T_적정신내성
        ENDIF
    ELSEIF 속성 == "고정"
        ;처리없음
    ENDIF
    IF T_적방어력 >= 0
        데미지 -= T_적방어력
    ELSE
        데미지 += T_적방어력
    ENDIF
    CALL 크리티컬판정(T_내운)
    IF RESULT == 1
        PRINTFORML 급소에 맞혔다!
        데미지 += T_내운
        TIMES 데미지 , 1.5
    ENDIF
    IF 데미지 > 0
        T_적체력 -= 데미지
        PRINTFORMW %T_적이% {데미지}만큼의 피해를 받았다!
    ELSEIF 데미지 <= -100
        PRINTFORMW 그러나 가볍게 피해버렸다...
    ELSE
        PRINTFORMW %T_적은% 아슬아슬하게 공격을 피했다!
    ENDIF
ENDIF


@크리티컬판정(ARG)
#DIM DYNAMIC 크리티컬
크리티컬 = MIN(ARG, 100)

IF 크리티컬 >= RAND:100 + 1
        ;명중
        RETURN 1
    ELSE
        ;빗나감
        RETURN 0
    ENDIF